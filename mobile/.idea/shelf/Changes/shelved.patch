Index: app/src/main/java/com/piggybank/renote/ui/catatan/CatatanViewModel.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.piggybank.renote.ui.catatan\r\n\r\nimport androidx.lifecycle.LiveData\r\nimport androidx.lifecycle.MutableLiveData\r\nimport androidx.lifecycle.ViewModel\r\nimport com.piggybank.renote.ui.rekening.RekeningViewModel\r\nimport java.util.Calendar\r\n\r\nclass CatatanViewModel : ViewModel() {\r\n\r\n    private val allData = mutableMapOf<String, MutableList<Catatan>>()\r\n\r\n    private val _catatanList = MutableLiveData<List<Catatan>>(emptyList())\r\n    val catatanList: LiveData<List<Catatan>> = _catatanList\r\n\r\n    private val _totalPemasukan = MutableLiveData(0.0)\r\n    val totalPemasukan: LiveData<Double> = _totalPemasukan\r\n\r\n    private val _totalPengeluaran = MutableLiveData(0.0)\r\n    val totalPengeluaran: LiveData<Double> = _totalPengeluaran\r\n\r\n    private val _totalSaldo = MutableLiveData(0.0)\r\n    val totalSaldo: LiveData<Double> = _totalSaldo\r\n\r\n    var selectedCatatan: Catatan? = null\r\n\r\n    var saldoChangeListener: ((Double) -> Unit)? = null\r\n\r\n    fun updateDataForDate(date: Calendar) {\r\n        val dateKey = getDateKey(date)\r\n        val currentList = allData[dateKey]?.toMutableList() ?: mutableListOf()\r\n        _catatanList.value = currentList\r\n\r\n        val pemasukan = currentList.filter { it.nominal.toDouble() >= 0 }.sumOf { it.nominal.toDouble() }\r\n        val pengeluaran = currentList.filter { it.nominal.toDouble() < 0 }.sumOf { it.nominal.toDouble() }\r\n        _totalPemasukan.value = pemasukan\r\n        _totalPengeluaran.value = pengeluaran\r\n        _totalSaldo.value = pemasukan + pengeluaran\r\n    }\r\n\r\n    fun addCatatan(date: Calendar, kategori: String, nominal: String, deskripsi: String) {\r\n        val dateKey = getDateKey(date)\r\n        val nominalValue = nominal.replace(\"[^\\\\d.-]\".toRegex(), \"\").toDoubleOrNull() ?: 0.0\r\n        val formattedDate = \"${date.get(Calendar.DAY_OF_MONTH)}-${date.get(Calendar.MONTH) + 1}-${date.get(Calendar.YEAR)}\"\r\n\r\n        val newCatatan = Catatan(kategori, nominalValue.toString(), deskripsi, formattedDate)\r\n\r\n        val currentList = allData[dateKey] ?: mutableListOf()\r\n        currentList.add(newCatatan)\r\n        allData[dateKey] = currentList\r\n        updateDataForDate(date)\r\n    }\r\n\r\n    fun editCatatan(date: Calendar, newNominal: String, newDeskripsi: String) {\r\n        selectedCatatan?.let { catatan ->\r\n            val dateKey = getDateKey(date)\r\n            val currentList = allData[dateKey]?.toMutableList() ?: mutableListOf()\r\n            val index = currentList.indexOf(catatan)\r\n            if (index != -1) {\r\n                val oldNominal = catatan.nominal.toDouble()\r\n                val newNominalValue = newNominal.replace(\"[^\\\\d.-]\".toRegex(), \"\").toDoubleOrNull() ?: 0.0\r\n\r\n                currentList[index] = catatan.copy(nominal = newNominal, deskripsi = newDeskripsi)\r\n                allData[dateKey] = currentList\r\n                updateDataForDate(date)\r\n\r\n                saldoChangeListener?.invoke(newNominalValue - oldNominal)\r\n            }\r\n        }\r\n    }\r\n\r\n    fun deleteSelectedCatatan(date: Calendar) {\r\n        selectedCatatan?.let { catatan ->\r\n            val dateKey = getDateKey(date)\r\n            val currentList = allData[dateKey]?.toMutableList() ?: mutableListOf()\r\n            if (currentList.remove(catatan)) {\r\n                allData[dateKey] = currentList\r\n                updateDataForDate(date)\r\n\r\n                saldoChangeListener?.invoke(-catatan.nominal.toDouble())\r\n            }\r\n        }\r\n    }\r\n\r\n    fun calculateSaldo(): Double {\r\n        return allData.values.flatten().sumOf { it.nominal.toDouble() }\r\n    }\r\n\r\n    fun refreshSaldo(rekeningViewModel: RekeningViewModel) {\r\n        val totalSaldo = calculateSaldo()\r\n        rekeningViewModel.setTotalSaldoDirectly(totalSaldo.toLong())\r\n    }\r\n\r\n    private fun getDateKey(date: Calendar): String {\r\n        return \"${date.get(Calendar.YEAR)}-${date.get(Calendar.MONTH) + 1}-${date.get(Calendar.DAY_OF_MONTH)}\"\r\n    }\r\n\r\n    fun clearSelectedCatatan() {\r\n        selectedCatatan = null\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/piggybank/renote/ui/catatan/CatatanViewModel.kt b/app/src/main/java/com/piggybank/renote/ui/catatan/CatatanViewModel.kt
--- a/app/src/main/java/com/piggybank/renote/ui/catatan/CatatanViewModel.kt	(revision ba42ae2bb106fdd4d0d513b4b9310fb1090de102)
+++ b/app/src/main/java/com/piggybank/renote/ui/catatan/CatatanViewModel.kt	(date 1732527710614)
@@ -3,6 +3,7 @@
 import androidx.lifecycle.LiveData
 import androidx.lifecycle.MutableLiveData
 import androidx.lifecycle.ViewModel
+import com.piggybank.renote.data.database.NoteRoomDatabase
 import com.piggybank.renote.ui.rekening.RekeningViewModel
 import java.util.Calendar
 
@@ -10,6 +11,8 @@
 
     private val allData = mutableMapOf<String, MutableList<Catatan>>()
 
+    private val dao = NoteRoomDatabase.getDatabase(application).noteDao()
+
     private val _catatanList = MutableLiveData<List<Catatan>>(emptyList())
     val catatanList: LiveData<List<Catatan>> = _catatanList
 
@@ -26,6 +29,8 @@
 
     var saldoChangeListener: ((Double) -> Unit)? = null
 
+
+
     fun updateDataForDate(date: Calendar) {
         val dateKey = getDateKey(date)
         val currentList = allData[dateKey]?.toMutableList() ?: mutableListOf()
Index: app/src/main/java/com/piggybank/renote/data/database/NoteDao.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.piggybank.renote.data.database\r\n\r\nimport androidx.room.Dao\r\nimport androidx.room.Insert\r\n\r\n@Dao\r\ninterface NoteDao {\r\n    @Insert\r\n    suspend fun insertNote(note: NoteEntity)\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/piggybank/renote/data/database/NoteDao.kt b/app/src/main/java/com/piggybank/renote/data/database/NoteDao.kt
--- a/app/src/main/java/com/piggybank/renote/data/database/NoteDao.kt	(revision ba42ae2bb106fdd4d0d513b4b9310fb1090de102)
+++ b/app/src/main/java/com/piggybank/renote/data/database/NoteDao.kt	(date 1732527376734)
@@ -2,9 +2,13 @@
 
 import androidx.room.Dao
 import androidx.room.Insert
+import androidx.room.Query
 
 @Dao
 interface NoteDao {
     @Insert
     suspend fun insertNote(note: NoteEntity)
+
+    @Query("SELECT * FROM notes WHERE tanggal = :dateKey")
+    suspend fun getCatatanByDate(dateKey: String): List<NoteEntity>
 }
